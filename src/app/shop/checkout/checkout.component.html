<app-breadcrumb [title]="'Checkout'" [breadcrumb]="'Checkout'"></app-breadcrumb>
<section class="section-b-space">
    <div class="container">
        <div class="checkout-page">
            <div class="checkout-form">
                <!-- <ngb-alert #selfClosingAlert *ngIf="successMessage" type="success" (closed)="successMessage = ''">
                    {{ successMessage }}
                </ngb-alert> -->
                <ngb-alert #staticAlert [type]="alert.type" *ngIf="!staticAlertClosed"
                    (closed)="staticAlertClosed = true">{{ alert.message }}</ngb-alert>
                <form>
                    <div class="row">
                        <div class="col-lg-6 col-sm-12 col-xs-12">
                            <div class="checkout-title">
                                <h3>Billing contact</h3>
                                <div class="row check-out mb-5">
                                    <div class="form-group col-md-12 col-sm-12 col-xs-12">
                                        <div class="field-label">Email</div>
                                        <input type="text" name="email" [formControl]="checkoutForm.controls['email']"
                                            value="" placeholder="" autocomplete="off">
                                        <div *ngIf="checkoutForm.controls.email.touched && checkoutForm.controls.email.errors?.required"
                                            class="text text-danger">
                                            Email is required.
                                        </div>
                                        <div *ngIf="checkoutForm.controls.email.touched && checkoutForm.controls.email.errors?.pattern"
                                            class="text text-danger">
                                            The email must have a valid structure.
                                        </div>
                                    </div> 
                                </div>
                            </div>
                            <div class="checkout-title">
                                <h3>Shipping Address Details</h3>
                            </div>
                            <div class="row check-out">
                                <div class="form-group col-md-12 col-sm-12 col-xs-12">
                                    <div class="field-label">FullName</div>
                                    <input type="text" name="fullname" [formControl]="checkoutForm.controls['fullname']"
                                        value="" placeholder="" autocomplete="off">
                                    <div *ngIf="checkoutForm.controls.fullname.touched && checkoutForm.controls.fullname.errors?.required"
                                        class="text text-danger">
                                        Full Name is required.
                                    </div>
                                    <div *ngIf="checkoutForm.controls.fullname.touched && checkoutForm.controls.fullname.errors?.pattern"
                                        class="text text-danger">
                                        Full Name must be an alphabates.
                                    </div>
                                </div>
                                <div class="form-group col-md-6 col-sm-6 col-xs-12">
                                    <div class="field-label">Phone</div>
                                    <input type="text" name="phone" [formControl]="checkoutForm.controls['phone']"
                                        value="" placeholder="" autocomplete="off">
                                    <div *ngIf="checkoutForm.controls.phone.touched && checkoutForm.controls.phone.errors?.required"
                                        class="text text-danger">
                                        Phone No is required.
                                    </div>
                                    <div *ngIf="checkoutForm.controls.phone.touched && checkoutForm.controls.phone.errors?.pattern"
                                        class="text text-danger">
                                        Phone No is must be number.
                                    </div>
                                </div>
                                <div class="form-group col-md-6 col-sm-6 col-xs-12">
                                    <div class="field-label">Country</div>
                                    <select name="country" [formControl]="checkoutForm.controls['country']">
                                        <option value="" selected>Select Country</option>
                                        <option value="US">USA</option>
                                    </select>
                                    <div *ngIf="checkoutForm.controls.country.touched && checkoutForm.controls.country.errors?.required"
                                        class="text text-danger">
                                        Country is required
                                    </div>
                                </div>
                                <div class="form-group col-md-12 col-sm-12 col-xs-12">
                                    <div class="field-label">Address</div>
                                    <input type="text" name="address" [formControl]="checkoutForm.controls['address']"
                                        value="" placeholder="" autocomplete="off">
                                    <div *ngIf="checkoutForm.controls.address.touched && checkoutForm.controls.address.errors?.required"
                                        class="text text-danger">
                                        Address is required
                                    </div>
                                    <div *ngIf="checkoutForm.controls.address.touched && checkoutForm.controls.address.errors?.maxlength"
                                        class="text text-danger">
                                        Maximum 50 character
                                    </div>
                                </div>
                                <div class="form-group col-md-12 col-sm-12 col-xs-12">
                                    <div class="field-label">Town/City</div>
                                    <input type="text" name="city" [formControl]="checkoutForm.controls['city']"
                                        value="" placeholder="" autocomplete="off">
                                    <div *ngIf="checkoutForm.controls.city.touched && checkoutForm.controls.city.errors?.required"
                                        class="text text-danger">
                                        City is required
                                    </div>
                                </div>
                                <div class="form-group col-md-12 col-sm-6 col-xs-12">
                                    <div class="field-label">State</div>
                                    <input type="text" name="state" [formControl]="checkoutForm.controls['state']"
                                        value="" placeholder="" autocomplete="off">
                                    <div *ngIf="checkoutForm.controls.state.touched && checkoutForm.controls.state.errors?.required"
                                        class="text text-danger">
                                        State is required
                                    </div>
                                </div>
                                <div class="form-group col-md-12 col-sm-6 col-xs-12">
                                    <div class="field-label">Postal Code</div>
                                    <input type="text" name="postalcode"
                                        [formControl]="checkoutForm.controls['postalcode']" value="" placeholder=""
                                        autocomplete="off">
                                    <div *ngIf="checkoutForm.controls.postalcode.touched && checkoutForm.controls.postalcode.errors?.required"
                                        class="text text-danger">
                                        Postalcode is required
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-lg-6 col-sm-12 col-xs-12">
                            <div class="checkout-details">
                                <div class="order-box">
                                    <div class="title-box">
                                        <div>Product <span> Total</span></div>
                                    </div>
                                    <ul class="qty" *ngIf='products.length'>
                                        <li class="d-flex align-items-center justify-content-between"
                                            *ngFor="let product of products">
                                            <div class="d-flex gap-2 align-items-center">
                                                <img style="width: 50px;" [src]="product.images[0].img_url" alt="">
                                                <div>
                                                    <p class="mb-0">{{ product.title }} Ã— {{ product.quantity }}</p>
                                                    <p class="mb-0">sku: {{ product.sku }}</p>
                                                </div>
                                            </div>
                                            <span>
                                                {{ (product.price | discount:product) * productService?.Currency.price |
                                                currency:productService?.Currency.currency:'symbol' }}
                                            </span>
                                        </li>
                                    </ul>
                                    <ul class="qty" *ngIf='!products.length'>
                                        <li class="empty-checkout"> There are no products in cart </li>
                                    </ul>
                                    <ul class="sub-total">
                                        <li>
                                            Subtotal <span class="count">{{ getsubTotal | async |
                                                currency:productService?.Currency.currency:'symbol'}}</span>
                                        </li>
                                        <li>
                                            Shipping cost <span class="count">{{ getShippingTotal | async |
                                                currency:productService?.Currency.currency:'symbol'}}</span>
                                        </li>
                                        <!-- <li>
                                            Tax <span class="count">$0.00</span>
                                        </li> -->
                                    </ul>
                                    <ul class="total">
                                        <li>Total <span class="count"><strong>{{ total |
                                                currency:productService?.Currency.currency:'symbol'}}</strong></span></li>
                                    </ul>
                                </div>

                                <div class="payment-box" *ngIf='products.length'>
                                    <!-- <div class="upper-box">
                                        <div class="payment-options">
                                            <ul>
                                                <li>
                                                    <div class="radio-option">
                                                        <input type="radio" [(ngModel)]="payment" [value]="'Stripe'"
                                                            name="payment-group" id="payment-2">
                                                        <label for="payment-2">Stripe
                                                            <span class="small-text">Please send a check to Store Name,
                                                                Store Street, Store Town, Store State / County, Store
                                                                Postcode.</span></label>
                                                    </div>
                                                </li>
                                                <li>
                                                    <div class="radio-option paypal">
                                                        <input type="radio" [(ngModel)]="payment" [value]="'Paypal'"
                                                            name="payment-group" id="payment-3">
                                                        <label for="payment-3">PayPal<span class="image"><img
                                                                    src="assets/images/paypal.png"
                                                                    alt="" /></span></label>
                                                    </div>
                                                </li>
                                            </ul>
                                        </div>
                                    </div> -->
                                    <div class="text-end">
                                        <button type="submit" class="btn-solid btn" [disabled]="!checkoutForm.valid"
                                            (click)="initPay()" *ngIf="payment == 'Stripe'">
                                            Place Order
                                        </button>
                                        <!-- <ngx-paypal [config]="payPalConfig" *ngIf="payment == 'Paypal'"></ngx-paypal> -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
                <div *ngIf="modal" class="custom-modal-background"></div>
                <div *ngIf="modal" class="custom-modal">
                    <div class="custom-modal-content">
                        <div class="custom-modal-header">
                            <h2>Payment method</h2>
                            <span class="close" (click)="closeModal()">X</span>
                        </div>
                        <div class="custom-modal-body">
                            <div class="shipping-address ">
                                <form id="address-form">
                                    <div id="address-element">

                                    </div>
                                </form>
                            </div>
                            <form id="payment-form">
                                <div id="payment-element">

                                </div>
                                <button id="submit" [disabled]="isLoading" (click)="doPay($event)">
                                    <div *ngIf="isLoading" class="spinner" [class.hidden]="!isLoading" id="spinner">
                                    </div>
                                    <span *ngIf="!isLoading" id="button-text">Pay now</span>
                                </button>
                                <div id="payment-message" class="">{{stripeMessage}}</div>
                            </form>
                        </div>
                    </div>
                </div>

            </div>
        </div>
    </div>
</section>